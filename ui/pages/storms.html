<div id='map'></div>
<div id='form'>
    <form id='formcontent'>
        <input type="month" name="period" id="period" value="2013-12" class="box"><br \>
        <input type="radio" name="time" id="month" value="Month"> Month
        <input type="radio" name="time" id="year" value="Year" checked> Year<br \>
    </form>

    <div id="wikiTable"></div>
</div>

<script type="text/javascript" src="js/wiki.js"></script>
<script>

var dataRepo = "data/storms";

var mapboxTiles = L.tileLayer('https://{s}.tiles.mapbox.com/v3/sandoz.i550lpml/{z}/{x}/{y}.png', {
    attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'
});
var map = L.map('map')
    .addLayer(mapboxTiles)
    .setView([39.82, -98.57], 4);

function onEachFeature(feature, layer) {
    if (feature.properties && feature.properties.windspeed) {
    var startdate = feature.properties.startdate;
    var startYear = startdate.substr(0, 4);
    var startMonth = startdate.substr(4, 2);
    var startDay = startdate.substr(6, 2);
    var startHour = startdate.substr(8, 2);
    var startMinute = startdate.substr(10, 2);


    var enddate = feature.properties.enddate;
    var endYear = enddate.substr(0, 4);
    var endMonth = enddate.substr(4, 2);
    var endDay = enddate.substr(6, 2);
    var endHour = enddate.substr(8, 2);
    var endMinute = enddate.substr(10, 2);


        layer.bindPopup('Start date: ' + startDay + '.' + startMonth + '.' + startYear + ' at ' + startHour + '.' + startMinute + '<br />' +
                        'End date: ' + endDay + '.' + endMonth + '.' + endYear + ' at ' + endHour + '.' + endMinute + '<br />' +
                        'Max. Windspeed: ' + (feature.properties.windspeed).toFixed(2) + 'km/h' + '<br />' +
                        'Max. Rainfall: ' + feature.properties.rainfall + '<br />' +
                        'Radius: ' + feature.properties.radius);
    }
}

$.getJSON(dataRepo+"/2013.json", function(extremeWinds) {
    //When GeoJSON is loaded
    geojson = L.geoJson(extremeWinds, {
        onEachFeature: onEachFeature,

        pointToLayer: function (feature, latlng) {
        	var radius = feature.properties.radius;
            return L.circle(latlng, radius, {
                fillColor: "#ff7800",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.3
            });
        }
    });
    map.addLayer(geojson);

});

var updateMap = function() {

    var date = $('#period').val().split('-');
    var fileName = "";
    if ($("#month").is(':checked')) {
            fileName = dataRepo+"/"+date[0]+date[1]+".json";
     }
    if ($("#year").is(':checked')) {
            fileName = dataRepo+"/"+date[0]+".json";
     }

    map.removeLayer(geojson);

    $.getJSON(fileName, function(data) {
    //When GeoJSON is loaded
    geojson = L.geoJson(data, {
        onEachFeature: onEachFeature,

        pointToLayer: function (feature, latlng) {
            var radius = feature.properties.radius;
            return L.circle(latlng, radius, {
                fillColor: "#ff7800",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.3
            });
        }
        });
    map.addLayer(geojson);
    });
 };

 $("#period").change(function(event) {

    event.preventDefault();
    updateMap();
    filterWiki("", usa, $('#period').val());
 });

  $("#month").change(function(event) {

    event.preventDefault();
    updateMap();
 });

   $("#year").change(function(event) {

    event.preventDefault();
    updateMap();
 });

</script>
